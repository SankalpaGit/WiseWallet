@page "/debt"

@using WiseWallet.Components.Layout
@using WiseWallet.Models
@using WiseWallet.Services

<NavBar />

<div class="container py-4">
    <div class="row">
        <!-- Form Section -->
        <div class="col-md-4">
            <div class="card border-warning">
                <div class="card-body">
                    <h5 class="card-title">Record Your Debt</h5>
                    <p class="card-text text-muted">Now it's easy to track your transaction</p>
                    <form>
                        <div class="mb-3">
                            <label for="date-taken" class="form-label">Date Taken</label>
                            <input type="date" class="form-control" id="date-taken" @bind="NewDebt.DateTaken">
                        </div>
                        <div class="mb-3">
                            <label for="due-date" class="form-label">Due Date</label>
                            <input type="date" class="form-control" id="due-date" @bind="NewDebt.DueDate">
                        </div>
                        <div class="mb-3">
                            <label for="source" class="form-label">Source</label>
                            <input type="text" class="form-control" id="source" @bind="NewDebt.Source">
                        </div>
                        <div class="mb-3">
                            <label for="tags" class="form-label">Tags</label>
                            <input type="text" class="form-control" id="tags" @bind="NewDebt.Tags">
                        </div>
                        <div class="mb-3">
                            <label for="amount" class="form-label">Amount</label>
                            <input type="number" class="form-control" id="amount" @bind="NewDebt.Amount">
                        </div>
                        <div class="mb-3">
                            <label for="note" class="form-label">Add the Note</label>
                            <textarea class="form-control" id="note" rows="2" @bind="NewDebt.Note"></textarea>
                        </div>
                        <button type="button" class="btn btn-warning w-100" @onclick="SubmitDebtForm">Add Debt</button>
                </form>

                </div>
            </div>
        </div>

        <!-- Details Table Section -->
        <div class="col-md-8">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5>Total: Rs 23000</h5>
                <div class="filter">
                    <label for="filter" class="me-2">Filter</label>
                    <select class="form-select form-select-sm d-inline w-auto" id="filter">
                        <option>Months</option>
                    </select>
                </div>
            </div>
            <div class="card border-warning">
                <div class="card-body p-0">
                    <table class="table table-bordered table-hover mb-0">
                        <thead class="table-warning">
                            <tr>
                                <th>S.No</th>
                                <th>Taken</th>
                                <th>Due</th>
                                <th>Source</th>
                                <th>Tags</th>
                                <th>Amount</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>1</td>
                                <td>2024-12-01</td>
                                <td>2024-12-31</td>
                                <td>Sankalpa Shresth</td>
                                <td>Loan</td>
                                <td>15000</td>
                                <td>Unpaid</td>
                                <td>
                                    <button class="btn btn-sm btn-danger">Clear Debt</button>
                                </td>
                            </tr>
                            <tr>
                                <td>2</td>
                                <td>2024-11-15</td>
                                <td>2024-12-15</td>
                                <td>Rajesh Shresth</td>
                                <td>Credit Card</td>
                                <td>8000</td>
                                <td>Paid</td>
                                <td>

                                    <button class="btn btn-sm btn-danger">Clear Debt</button>
                                </td>
                            </tr>
                            <!-- Add more rows here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

@code {
    private DebtModel NewDebt = new();

    private void SubmitDebtForm()
    {
        // Retrieve the logged-in user
        var loggedInUser = LoginServices.GetLoggedInUser();

        if (loggedInUser != null)
        {
            int currentUserId = loggedInUser.UserId;

            // Ensure the default status is set to "Unpaid"
            NewDebt.Status = "Unpaid";

            bool success = DebtServices.AddDebt(currentUserId, NewDebt);
            if (success)
            {
                Console.WriteLine("Debt added successfully!");
                // Optionally clear the form or notify the user
                NewDebt = new DebtModel();
            }
            else
            {
                Console.WriteLine("Failed to add debt.");
            }
        }
        else
        {
            Console.WriteLine("No user is logged in. Cannot add debt.");
        }
    }
}




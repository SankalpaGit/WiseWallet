@page "/transaction"

@using WiseWallet.Components.Layout
@using WiseWallet.Models
@using WiseWallet.Services

<NavBar />

<div class="container py-4">
    <div class="row">
        <!-- Form Section -->
        <div class="col-md-4">
            <div class="card border-warning">
                <div class="card-body">
                    <h5 class="card-title">Add the Transaction</h5>
                    <p class="card-text text-muted">Now it's easy to track your transaction</p>
                    <form>
                        <div class="mb-3">
                            <label for="date" class="form-label">Date</label>
                            <input type="date" class="form-control" id="date" @bind="NewTransaction.Date">
                        </div>
                        <div class="mb-3">
                            <label for="type" class="form-label">Type</label>
                            <select class="form-select" id="type" @bind="SelectedType">
                                <option value="">Select Type</option>
                                <option value="income">Income</option>
                                <option value="expense">Expense</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="tags" class="form-label">Tags</label>
                            <input type="text" class="form-control" id="tags" placeholder="Enter tags" @bind="NewTransaction.Tags">
                        </div>
                        <div class="mb-3">
                            <label for="amount" class="form-label">Amount</label>
                            <input type="number" class="form-control" id="amount" placeholder="Enter amount" @bind="NewTransaction.Amount">
                        </div>
                        <div class="mb-3">
                            <label for="note" class="form-label">Add the note</label>
                            <textarea class="form-control" id="note" rows="2" placeholder="Enter note" @bind="NewTransaction.Note"></textarea>
                        </div>
                        <button type="button" class="btn btn-warning w-100" @onclick="SubmitTransactionForm">Add Cash</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

@code {
    private TransactionModel NewTransaction = new();
    private string SelectedType = string.Empty;

    private void SubmitTransactionForm()
    {
        var loggedInUser = LoginServices.GetLoggedInUser();

        if (loggedInUser != null && !string.IsNullOrEmpty(SelectedType))
        {
            bool success = false;

            if (SelectedType == "income")
            {
                success = TransactionServices.AddIncome(loggedInUser.UserId, NewTransaction);
            }
            else if (SelectedType == "expense")
            {
                success = TransactionServices.AddExpense(loggedInUser.UserId, NewTransaction);
            }

            if (success)
            {
                Console.WriteLine("Transaction added successfully!");
                NewTransaction = new TransactionModel(); // Clear form
                SelectedType = string.Empty; // Reset type
            }
            else
            {
                Console.WriteLine("Failed to add transaction.");
            }
        }
        else
        {
            Console.WriteLine("Invalid user or transaction type.");
        }
    }
}
